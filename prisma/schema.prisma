generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  runtime  = "deno"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Service {
  slug         String    @id @db.VarChar(36) @default(uuid())
  serviceName  ServiceName @map("service_name") @unique
  createdAt    DateTime? @default(now()) @db.Timestamptz(6) @map("created_at")
  users        User[]

  @@map("services")
}

enum ServiceName {
  ftp
  income_calculator
}

model User {
  slug         String    @id @db.VarChar(36) @default(uuid())
  email        String    @db.VarChar(200)
  username     String?   @db.VarChar(32)
  image        String?
  password     String    @db.VarChar(200)
  createdAt    DateTime? @default(now()) @db.Timestamptz(6) @map("created_at")
  serviceSlug  String?   @db.VarChar(36) @map("service_slug")
  services     Service? @relation(fields: [serviceSlug], references: [slug], onDelete: SetNull, map: "fk_service_slug")

  @@unique([username, email, serviceSlug], map: "unique_email_and_username_service")
  @@unique([email, serviceSlug], map: "unique_email_service")
  @@unique([username, serviceSlug], map: "unique_username_service")

  @@map("users")
}
